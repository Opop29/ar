<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Indoor AR Navigation (Floating Pen Demo)</title>
  <style>
    body {margin:0; font-family:sans-serif; background:#000; color:#fff;}
    header {padding:10px; background:#111; text-align:center;}
    video {width:100%; height:60vh; object-fit:cover; background:#000;}
    .overlay {
      position:absolute; inset:0;
      display:flex; justify-content:center; align-items:center;
      pointer-events:none;
    }

    /* Floating glowing pen */
    .arrow {
      position:relative;
      width: 14px;
      height: 120px;
      background: linear-gradient(to bottom, #00ffea, #0066ff);
      border-radius: 8px;
      box-shadow: 0 0 20px #00ffee, 0 0 40px #00aaff;
      animation: float 2s ease-in-out infinite;
      transform-origin: center bottom;
    }
    /* pointy glowing tip */
    .arrow::after {
      content: "";
      position: absolute;
      top: -20px; left: 50%;
      transform: translateX(-50%);
      width: 0; height: 0;
      border-left: 10px solid transparent;
      border-right: 10px solid transparent;
      border-bottom: 20px solid #00ffee;
      filter: drop-shadow(0 0 10px #00ffee);
    }
    @keyframes float {
      0%   { transform: translateY(0) scale(1); }
      50%  { transform: translateY(-10px) scale(1.05); }
      100% { transform: translateY(0) scale(1); }
    }

    .controls {padding:15px; background:#111;}
    select, button {
      padding:10px; font-size:16px; margin:5px;
      border-radius:8px; border:none;
    }
    select {width:150px;}
    button {background:#00bfff; color:#fff; cursor:pointer;}
    .status {margin-top:10px; font-size:14px; color:#ccc;}
  </style>
</head>
<body>
  <header>
    <h1>Indoor AR Navigation (Floating Pen)</h1>
  </header>

  <div style="position:relative">
    <video id="video" autoplay playsinline muted></video>
    <div class="overlay"><div id="arrow" class="arrow"></div></div>
  </div>

  <div class="controls">
    <label>Current Location: </label>
    <select id="current">
      <option value="Entrance">Entrance</option>
      <option value="Dining">Dining</option>
      <option value="Room1">Room 1</option>
      <option value="Room2">Room 2</option>
      <option value="CR">CR</option>
    </select><br/>

    <label>Destination: </label>
    <select id="destination">
      <option value="CR">CR</option>
      <option value="Room1">Room 1</option>
      <option value="Room2">Room 2</option>
      <option value="Dining">Dining</option>
      <option value="Entrance">Entrance</option>
    </select><br/>

    <button id="startBtn">Start Navigation</button>
    <button id="nextBtn">Next Step</button>
    <div class="status" id="status">Choose a start and destination.</div>
  </div>

  <script>
    // --- Camera background ---
    const video = document.getElementById('video');
    async function initCamera(){
      try {
        const stream = await navigator.mediaDevices.getUserMedia({ video:{ facingMode:"environment" }, audio:false });
        video.srcObject = stream;
      } catch(e){
        console.warn("Camera error", e);
      }
    }
    initCamera();

    // --- House Map (Graph)
    const houseMap = {
      Entrance: ["Dining"],
      Dining: ["Entrance", "Room1", "Room2", "CR"],
      Room1: ["Dining"],
      Room2: ["Dining"],
      CR: ["Dining"]
    };

    // Predefined arrow directions (fake AR for demo)
    const arrowDirections = {
      "Entrance->Dining": 0,
      "Dining->Room1": -90,
      "Dining->Room2": 90,
      "Dining->CR": 180,
      "Dining->Entrance": 180,
      "Room1->Dining": 90,
      "Room2->Dining": -90,
      "CR->Dining": 0
    };

    // --- Navigation state
    let currentRoom = "Entrance";
    let path = [];
    let stepIndex = 0;

    const arrow = document.getElementById('arrow');
    const status = document.getElementById('status');

    function findPath(start, dest){
      // BFS pathfinding
      const queue = [[start]];
      const visited = new Set([start]);
      while(queue.length){
        const path = queue.shift();
        const node = path[path.length-1];
        if(node === dest) return path;
        for(const nei of houseMap[node]||[]){
          if(!visited.has(nei)){
            visited.add(nei);
            queue.push([...path, nei]);
          }
        }
      }
      return null;
    }

    function updateArrow(){
      if(stepIndex >= path.length-1){
        status.textContent = `Arrived at ${path[path.length-1]} ðŸŽ‰`;
        arrow.style.display = "none";
        return;
      }
      const from = path[stepIndex];
      const to = path[stepIndex+1];
      const key = `${from}->${to}`;
      const dir = arrowDirections[key] ?? 0;
      arrow.style.transform = `rotate(${dir}deg)`;
      arrow.style.display = "block";
      status.textContent = `Go from ${from} â†’ ${to}`;
    }

    document.getElementById('startBtn').addEventListener('click', ()=>{
      const start = document.getElementById('current').value;
      const dest = document.getElementById('destination').value;
      currentRoom = start;
      path = findPath(start, dest);
      if(!path){
        status.textContent = "No path found.";
        return;
      }
      stepIndex = 0;
      updateArrow();
    });

    document.getElementById('nextBtn').addEventListener('click', ()=>{
      if(stepIndex < path.length-1){
        stepIndex++;
        currentRoom = path[stepIndex];
        updateArrow();
      }
    });
  </script>
</body>
</html>
